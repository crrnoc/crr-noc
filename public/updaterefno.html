<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Update Fee Payment</title>
  <link rel="icon" href="crrengglogo.png" type="image/png" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #1d1d1d;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

.container {
  min-height: 100vh;
}

.sidebar {
  width: 270px;
  background-color: rgb(247, 201, 155);
  display: flex;
  flex-direction: column;
  padding: 20px;
  box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);

  position: fixed; /* üß∑ Lock it */
  top: 0;
  bottom: 0;
  left: 0;
  overflow-y: auto;
    }

    .sidebar h2 {
      margin: 40px 20px 20px 20px;
      color: black;
      font-size: 18px;
      font-weight: bold;
    }

    .menu {
      list-style-type: none;
      padding: 0;
    }

    .menu li {
      margin-bottom: 15px;
    }

    .menu li a {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      color: black;
      padding: 12px 20px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .menu li a:hover,
    .menu li.active a {
      background-color: #d4d4d4;
      font-weight: bold;
      transform: translateX(5px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }

    .menu li a span {
      font-size: 18px;
      transition: transform 0.3s ease;
    }

    .menu li a:hover span {
      transform: scale(1.2);
    }

    .logout {
      background-color: #f09000;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 16px;
      width: 50%;
      margin: 20px auto 0;
      transition: background 0.3s ease;
    }

    .logout:hover {
      background-color: #d07900;
    }

.main {
  flex-grow: 1;
  background-color: white;
  padding: 40px;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  margin-left: 270px; /* Same as sidebar width */
}

.form {
  background: linear-gradient(135deg, rgba(54, 169, 225, 0.85), rgba(30, 130, 190, 0.85));
  padding: 35px;
  border-radius: 20px;
  width: 100%;
  max-width: 600px;
  color: #fff;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  box-shadow: 0 12px 20px rgba(0, 0, 0, 0.3), 0 6px 8px rgba(0, 0, 0, 0.22);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.form:hover {
  transform: scale(1.01);
  box-shadow: 0 16px 28px rgba(0, 0, 0, 0.35);
}

    .form .input-group {
      margin-bottom: 20px;
    }

    .form label {
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
    }

 .form input {
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 8px;
  margin-top: 6px;
  background-color: rgba(255, 255, 255, 0.9);
  color: #000;
  font-size: 15px;
  transition: box-shadow 0.3s ease;
}

.form input:focus {
  outline: none;
  box-shadow: 0 0 6px rgba(54, 169, 225, 0.8);
}


    .form input[type="number"] {
      margin-top: 10px;
    }

    .buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 25px;
    }

    .buttons button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;

    }

    .buttons .update {
      background-color: #4CAF50;
      color: white;
    }
     .buttons:hover {
  transform: scale(1.01);
  box-shadow: 0 16px 28px rgba(0, 0, 0, 0.35);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
      }

      .main {
        padding: 20px;
      }
    }

    .form select {
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 8px;
  margin-top: 6px;
  background-color: rgba(255, 255, 255, 0.9);
  color: #000;
  font-size: 15px;
  transition: box-shadow 0.3s ease;
}
.form select:focus {
  outline: none;
  box-shadow: 0 0 6px rgba(54, 169, 225, 0.8);
}

  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2><strong>ID:</strong> <span id="userId">Loading...</span></h2>
      <ul class="menu">
        <li><a href="studentdetails.html"><span>üìÑ</span> Student details</a></li>
        <li><a href="editprofile.html"><span>‚úèÔ∏è</span> Edit profile</a></li>
        <li><a href="feedetails.html"><span>üéì</span> Fee details</a></li>
        <li class="active"><a href="#"><span>üîÑ</span> Update fee payment</a></li>
        <li><a href="generatenoc.html"><span>‚ûï</span> Generate NOC</a></li>
        <li><a href="settings.html"><span>‚öôÔ∏è</span> Settings</a></li>
        <li><a href="notifications.html"><span>üîî</span> Notifications</a></li>
        <li><a href="privacypolicy.html"><span>üìú</span> Privacy policy</a></li>
      </ul>
      <button class="logout" onclick="logout()">Logout</button>
    </div>

    <!-- Main Content -->
    <div class="main">
      <div class="form">
         <div class="input-group">
  <label>Select Academic Year</label>
  <select id="academicYear" required>
    <option value="" disabled selected>Choose Year</option>
    <option value="1">1st Year</option>
    <option value="2">2nd Year</option>
    <option value="3">3rd Year</option>
    <option value="4">4th Year</option>
  </select>
</div>
        <div class="input-group">
          <label>Tuition Fee</label>
          <input type="text" id="tuition" placeholder="Enter DU number">
          <input type="number" id="tuitionAmount" placeholder="Enter Amount Paid">
        </div>
        <div class="input-group">
          <label>Hostel Fee</label>
          <input type="text" id="hostel" placeholder="Enter DU number">
          <input type="number" id="hostelAmount" placeholder="Enter Amount Paid">
        </div>
        <div class="input-group">
          <label>Bus Fee</label>
          <input type="text" id="bus" placeholder="Enter DU number">
          <input type="number" id="busAmount" placeholder="Enter Amount Paid">
        </div>
        <div class="input-group">
          <label>University Fee</label>
          <input type="text" id="university" placeholder="Enter DU number">
          <input type="number" id="universityAmount" placeholder="Enter Amount Paid">
        </div>
        <div class="input-group">
          <label>Semester Fee</label>
          <input type="text" id="semester" placeholder="Enter DU number">
          <input type="number" id="semesterAmount" placeholder="Enter Amount Paid">
        </div>
        <div class="input-group">
          <label>Library Dues</label>
          <input type="text" id="library" placeholder="Enter DU number">
          <input type="number" id="libraryAmount" placeholder="Enter Amount Paid">
        </div>
        <div class="input-group">
          <label>Fines</label>
          <input type="text" id="fines" placeholder="Enter DU number">
          <input type="number" id="finesAmount" placeholder="Enter Amount Paid">
        </div>
        <div class="buttons">
          <button class="update">Update</button>
        </div>
      </div>
    </div>
  </div>

<script>
  const userId = localStorage.getItem("userId");
  document.getElementById("userId").textContent = userId;

  document.querySelector(".update").addEventListener("click", () => {
    const paymentData = [
      { type: "tuition", du: tuition.value, amount: tuitionAmount.value },
      { type: "hostel", du: hostel.value, amount: hostelAmount.value },
      { type: "bus", du: bus.value, amount: busAmount.value },
      { type: "university", du: university.value, amount: universityAmount.value },
      { type: "semester", du: semester.value, amount: semesterAmount.value },
      { type: "library", du: library.value, amount: libraryAmount.value },
      { type: "fines", du: fines.value, amount: finesAmount.value }
    ].filter(entry => entry.du.trim() !== "" && entry.amount.trim() !== "");

    if (paymentData.length === 0) {
      alert("Please enter at least one DU number.");
      return;
    }
      const academicYear = parseInt(document.getElementById("academicYear").value);
if (!academicYear) {
  alert("Please select academic year.");
  return;
}

    fetch("http://localhost:3000/submit-du", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
body: JSON.stringify({ userId, payments: paymentData, academic_year: academicYear })

    })
      .then(res => res.json())
      .then(data => {
        alert(data.message || "DU numbers submitted successfully.");
      })
      .catch(err => {
        console.error("Error submitting DU numbers:", err);
        alert("Something went wrong.");
      });
  });

  document.querySelectorAll('.form input[type="number"]').forEach(input => {
    input.addEventListener('input', () => {
      input.value = input.value.replace(/[^\d]/g, '');
    });
  });

  // ‚èé Enter key moves cursor to next field
  document.querySelectorAll('.form input').forEach((input, index, inputs) => {
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        let nextInput = inputs[index + 1];
        if (nextInput) nextInput.focus();
      }
    });
  });

  // Logout handler
  function logout() {
    localStorage.removeItem("userId");
    if ("caches" in window) {
      caches.keys().then((names) => names.forEach((name) => caches.delete(name)));
    }
    window.location.replace("index.html");
  }

  // üîê Prevent back/forward after logout
  window.addEventListener("pageshow", function (event) {
    const userId = localStorage.getItem("userId");
    if (!userId) {
      alert("Please login first.");
      window.location.replace("index.html");
    }
  });
</script>
</body>
</html>
