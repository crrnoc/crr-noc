<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Results</title>
  <link rel="icon" href="crrengglogo.png" type="image/png" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f7fa;
      color: #333;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    select {
      padding: 8px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
    }

    th {
      background-color: #007BFF;
      color: white;
    }

    .stats {
      margin-top: 20px;
      font-size: 18px;
      background: #e9f5ff;
      padding: 15px;
      border-left: 5px solid #007BFF;
    }

    .error {
      color: red;
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h2>ðŸ“˜ View Semester Results</h2>

  <div style="text-align:center;">
    <label for="semester">Select Semester:</label>
    <select id="semester" onchange="fetchResults()">
      <option value="">--Select Semester--</option>
      <option value="1-1">1-1</option>
      <option value="1-2">1-2</option>
      <option value="2-1">2-1</option>
      <option value="2-2">2-2</option>
      <option value="3-1">3-1</option>
      <option value="3-2">3-2</option>
      <option value="4-1">4-1</option>
      <option value="4-2">4-2</option>
    </select>
  </div>

  <div id="resultContainer"></div>

<script>
  async function fetchResults() {
    const regno = localStorage.getItem("regno");
    const semester = document.getElementById("semester").value;
    const container = document.getElementById("resultContainer");

    container.innerHTML = "";

    if (!regno) {
      container.innerHTML = "<p class='error'>Student not logged in. Please login first.</p>";
      return;
    }

    if (!semester) {
      container.innerHTML = "<p class='error'>Please select a semester.</p>";
      return;
    }

    try {
      container.innerHTML = "<p>Loading results...</p>";

      const response = await fetch(`https://crr-noc.onrender.com/student/results`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ regno, semester })
      });

      const data = await response.json();

      if (!data.results || data.results.length === 0) {
        container.innerHTML = "<p class='error'>No results found for this semester.</p>";
        return;
      }

      let html = `<h3>Results for <strong>${data.regno}</strong> - Semester <strong>${data.semester}</strong></h3>`;
      html += `<table>
                <tr>
                  <th>Subject Code</th>
                  <th>Subject Name</th>
                  <th>Grade</th>
                  <th>Credits</th>
                </tr>`;

      data.results.forEach(row => {
        html += `<tr>
                  <td>${row.subcode}</td>
                  <td>${row.subname || '-'}</td>
                  <td>${row.grade}</td>
                  <td>${row.credits || '-'}</td>
                </tr>`;
      });

      html += `</table>`;
      html += `<div class="stats">
                 <strong>SGPA:</strong> ${data.sgpa} &nbsp;&nbsp;
                 <strong>CGPA:</strong> ${data.cgpa} &nbsp;&nbsp;
                 <strong>Percentage:</strong> ${data.percentage}%
               </div>`;

      container.innerHTML = html;
    } catch (err) {
      console.error("Error fetching results:", err);
      container.innerHTML = "<p class='error'>Error fetching results. Please try again later.</p>";
    }
  }
</script>

</body>
</html>
