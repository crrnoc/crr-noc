<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Help & Feedback - STUDENT PORTAL</title>
    <link rel="icon" href="crrengglogo.png" type="image/png" />
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.20/dist/sweetalert2.min.css"
    />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #0b2e59;
            --secondary-color: #2c6e91;
            --accent-color: #f7a048;
            --background-dark: #f0f2f5;
            --background-light: #ffffff;
            --text-dark: #333333;
            --text-light: #f4f4f4;
            --card-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --border-radius-lg: 16px;
            --border-radius-md: 10px;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-dark);
        }

        body.no-scroll {
            overflow: hidden;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: var(--primary-color);
            display: flex;
            flex-direction: column;
            padding: 30px 20px;
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .photo-container {
            display: flex;
            justify-content: center;
            position: relative;
            margin-bottom: 20px;
        }

        .home-icon {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: var(--background-light);
            color: var(--primary-color);
            border-radius: 50%;
            font-size: 22px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, background-color 0.3s ease;
        }

        .home-icon:hover {
            transform: scale(1.1);
            background-color: var(--accent-color);
            color: var(--text-light);
        }

        .sidebar-photo {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            margin: 0 auto 10px;
            border: 4px solid var(--accent-color);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .sidebar h2 {
            margin: 40px 20px 20px 20px;
            color: var(--text-light);
            font-size: 1.1rem;
            font-weight: bold;
        }

        .menu {
            list-style: none;
            padding: 0;
            flex-grow: 1;
        }

        .menu li {
            list-style: none;
            margin-bottom: 12px;
        }

        .menu li a {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1rem;
            color: var(--text-light);
            padding: 15px 20px;
            border-radius: var(--border-radius-md);
            transition: all 0.3s ease;
        }

        .menu li a:hover,
        .menu li.active a {
            background-color: rgba(255, 255, 255, 0.1);
            font-weight: 500;
            transform: translateX(5px);
            box-shadow: var(--card-shadow);
        }

        .menu li a i {
            font-size: 1.2rem;
            width: 25px;
            text-align: center;
            color: var(--text-light);
            transition: color 0.3s ease;
        }

        .logout {
            background-color: var(--accent-color);
            color: var(--text-light);
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            width: 60%;
            margin: 20px auto 0;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .logout:hover {
            background-color: #d3853b;
            transform: scale(1.05);
        }

        /* Main Section */
        .main-section {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--background-dark);
            padding: 40px 30px;
            margin-left: 280px;
            transition: margin-left 0.3s ease-in-out;
            min-height: 100vh;
        }

        /* Back Button */
        .back-button {
            align-self: flex-start;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: var(--background-light);
            color: var(--primary-color);
            border-radius: var(--border-radius-md);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            font-weight: 500;
            text-decoration: none;
            border: none;
            cursor: pointer;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            background: linear-gradient(135deg, var(--background-light), #f8f9fa);
        }

        .back-button i {
            font-size: 1.1rem;
        }

        /* Main Card */
        .feedback-card {
            background-color: var(--background-light);
            color: var(--text-dark);
            width: 100%;
            max-width: 700px;
            padding: 35px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .feedback-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }

        .feedback-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .feedback-card h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 2rem;
            font-weight: 700;
            padding-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .feedback-description {
            text-align: center;
            color: var(--secondary-color);
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.6;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: var(--border-radius-md);
            border-left: 4px solid var(--accent-color);
        }

        /* Form Styling */
        .feedback-form {
            background: var(--background-light);
            padding: 0;
            border-radius: var(--border-radius-md);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group label i {
            font-size: 1.1rem;
            color: var(--accent-color);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 15px 18px;
            font-size: 1rem;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius-md);
            background: var(--background-light);
            color: var(--text-dark);
            transition: all 0.3s ease;
            font-family: inherit;
            resize: vertical;
        }

        .form-group input:hover,
        .form-group textarea:hover {
            border-color: var(--secondary-color);
            background: #f8f9fa;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            background: #f8f9fa;
            box-shadow: 0 0 0 3px rgba(11, 46, 89, 0.1);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #6c757d;
            font-style: italic;
        }

        /* Submit Button */
        .submit-button {
            width: 100%;
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-light);
            border: none;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .submit-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .submit-button:hover::before {
            left: 100%;
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
        }

        .submit-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .submit-button:disabled:hover {
            transform: none;
            box-shadow: none;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .submit-button i {
            font-size: 1.2rem;
        }

        /* Help Section */
        .help-section {
            background: linear-gradient(135deg, rgba(23, 162, 184, 0.1), rgba(23, 162, 184, 0.05));
            border-left: 4px solid var(--info-color);
            padding: 20px;
            border-radius: var(--border-radius-md);
            margin-bottom: 25px;
        }

        .help-section h4 {
            color: var(--info-color);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-section p {
            color: var(--text-dark);
            line-height: 1.6;
            font-size: 0.95rem;
            margin-bottom: 10px;
        }

        .help-section ul {
            color: var(--text-dark);
            margin-left: 20px;
            line-height: 1.6;
        }

        .help-section li {
            margin-bottom: 5px;
        }

        /* Mobile Toggle & Overlay */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: var(--secondary-color);
            color: var(--text-light);
            font-size: 24px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
            border: none;
        }

        .mobile-toggle:hover {
            transform: scale(1.1);
            background-color: var(--accent-color);
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(3px);
            z-index: 999;
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
        }

        .overlay.active {
            display: block;
            opacity: 1;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .mobile-toggle {
                display: flex;
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 250px;
                max-width: 85vw;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-section {
                margin-left: 0;
                padding: 25px 20px;
                justify-content: flex-start;
                padding-top: 40px;
            }

            .back-button {
                margin-bottom: 15px;
            }
            
            .feedback-card {
                padding: 25px;
            }

            .feedback-card h2 {
                font-size: 1.6rem;
                margin-bottom: 15px;
            }

            .feedback-description {
                margin-bottom: 25px;
                padding: 18px;
                font-size: 1rem;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group input,
            .form-group textarea {
                padding: 12px 15px;
                font-size: 0.95rem;
            }

            .submit-button {
                padding: 12px 20px;
                font-size: 1rem;
            }

            .help-section {
                padding: 18px;
                margin-bottom: 20px;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                width: 220px;
                max-width: 75vw;
                padding: 20px 15px;
            }

            .sidebar h2 {
                font-size: 1rem;
                margin: 20px 10px;
            }

            .menu li a {
                font-size: 0.9rem;
                padding: 12px 15px;
                gap: 10px;
            }

            .logout {
                width: 80%;
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .main-section {
                padding: 20px 15px;
                padding-top: 35px;
            }

            .back-button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .feedback-card {
                padding: 20px;
                border-radius: var(--border-radius-md);
            }

            .feedback-card h2 {
                font-size: 1.4rem;
                margin-bottom: 12px;
            }

            .feedback-description {
                margin-bottom: 20px;
                padding: 15px;
                font-size: 0.9rem;
            }

            .form-group {
                margin-bottom: 18px;
            }

            .form-group label {
                font-size: 0.95rem;
                margin-bottom: 6px;
            }

            .form-group input,
            .form-group textarea {
                padding: 12px 15px;
                font-size: 0.9rem;
            }

            .submit-button {
                padding: 12px 18px;
                font-size: 0.95rem;
            }

            .help-section {
                padding: 15px;
                margin-bottom: 18px;
            }

            .help-section h4 {
                font-size: 1rem;
            }

            .help-section p {
                font-size: 0.9rem;
            }

            .mobile-toggle {
                width: 45px;
                height: 45px;
                font-size: 20px;
                top: 15px;
                left: 15px;
            }
        }

        @media (max-width: 360px) {
            .feedback-card {
                padding: 15px;
                margin: 15px auto;
            }

            .feedback-card h2 {
                font-size: 1.2rem;
            }

            .feedback-description {
                padding: 12px;
                font-size: 0.85rem;
            }

            .form-group input,
            .form-group textarea {
                padding: 10px 12px;
                font-size: 0.85rem;
            }

            .submit-button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .help-section {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="overlay" onclick="toggleMobileMenu()"></div>
    
    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="photo-container">
                <a href="studentwelcome.html" class="home-icon" title="Home">
                    <i class="fas fa-home"></i>
                </a>
                <img id="sidebarPhoto" class="sidebar-photo" style="display: none;" />
            </div>

            <h2>ID: <span id="userId">Loading...</span></h2>
            
            <ul class="menu">
                <li>
                    <a href="studentdetails.html"><i class="fas fa-user-circle"></i> Student details</a>
                </li>
                <li>
                    <a href="feedetails.html"><i class="fas fa-graduation-cap"></i> Fee details</a>
                </li>
                <li>
                    <a href="updaterefno.html"><i class="fas fa-sync-alt"></i> Update fee payment</a>
                </li>
                <li>
                    <a href="attendence.html"><i class="fas fa-calendar-alt"></i> View Attendance</a>
                </li>
                <li>
                    <a href="studentresults.html"><i class="fas fa-chart-bar"></i> Student Results</a>
                </li>
                <li>
                    <a href="generatenoc.html"><i class="fas fa-file-invoice"></i> Generate NOC</a>
                </li>
                <li class="active">
                    <a href="settings.html"><i class="fas fa-cog"></i> Settings</a>
                </li>
            </ul>
            
            <button class="logout" onclick="confirmLogout()">Logout</button>
        </div>

        <div class="main-section">
            <button class="back-button" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
                Back to Settings
            </button>

            <div class="feedback-card">
                <h2><i class="fas fa-comment-dots"></i> Help & Feedback</h2>
                
                <div class="feedback-description">
                    <strong>We're here to help!</strong> If you have any questions, suggestions, or feedback about the student portal, please fill out the form below. We value your input and will get back to you as soon as possible.
                </div>

                <div class="help-section">
                    <h4><i class="fas fa-info-circle"></i> What can we help you with?</h4>
                    <ul>
                        <li>Technical issues or bugs in the portal</li>
                        <li>Questions about your student records or results</li>
                        <li>Problems with fee payments or NOC generation</li>
                        <li>Suggestions for improving the portal</li>
                        <li>General feedback about your experience</li>
                    </ul>
                </div>

                <form class="feedback-form" id="feedbackForm">
                    <div class="form-group">
                        <label for="name">
                            <i class="fas fa-user"></i> Your Name
                        </label>
                        <input 
                            type="text" 
                            id="name" 
                            placeholder="Enter your full name" 
                            required 
                        />
                    </div>

                    <div class="form-group">
                        <label for="email">
                            <i class="fas fa-envelope"></i> Your Email
                        </label>
                        <input 
                            type="email" 
                            id="email" 
                            placeholder="Enter your email address" 
                            required 
                        />
                    </div>

                    <div class="form-group">
                        <label for="message">
                            <i class="fas fa-comment-alt"></i> Your Message
                        </label>
                        <textarea 
                            id="message" 
                            rows="6" 
                            placeholder="Please describe your question, issue, or feedback in detail (minimum 3 words required)" 
                            required
                        ></textarea>
                    </div>

                    <button type="submit" class="submit-button">
                        <i class="fas fa-paper-plane"></i>
                        Send Feedback
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <button class="mobile-toggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.20/dist/sweetalert2.all.min.js"></script>
    <script>
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.overlay');
            const body = document.body;
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
            body.classList.toggle('no-scroll');
        }

        document.querySelectorAll(".menu li a").forEach(link => {
            link.addEventListener("click", () => {
                if (window.innerWidth <= 992) {
                    toggleMobileMenu();
                }
            });
        });

        function goBack() {
            window.location.href = "settings.html";
        }

        function confirmLogout() {
            Swal.fire({
                title: 'Are you sure?',
                text: "You will be logged out of your account.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#0b2e59',
                cancelButtonColor: '#f7a048',
                confirmButtonText: 'Yes, log out!'
            }).then((result) => {
                if (result.isConfirmed) {
                    logout();
                }
            });
        }

        function logout() {
            fetch("/logout", { method: "GET", credentials: "include" })
              .then(() => {
                  localStorage.clear();
                  sessionStorage.clear();
                  if ("caches" in window) {
                      caches.keys().then(names => names.forEach(name => caches.delete(name)));
                  }
                  window.location.replace("index.html");
              })
              .catch(() => {
                  window.location.replace("index.html");
              });
        }

        // Prevent back navigation after logout
        window.history.pushState(null, "", window.location.href);
        window.onpopstate = () => window.history.pushState(null, "", window.location.href);

        document.addEventListener("DOMContentLoaded", async () => {
            const userId = localStorage.getItem("userId") || localStorage.getItem("regno");
            
            // Check authentication
            if (!userId) {
                Swal.fire({
                    title: 'Access Denied',
                    text: 'Please login first to view this page.',
                    icon: 'error',
                    confirmButtonText: 'Go to Login',
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    confirmButtonColor: '#0b2e59'
                }).then(() => {
                    window.location.href = "index.html";
                });
                return;
            }

            document.getElementById("userId").textContent = userId;

            // Load sidebar photo
            try {
                const res = await fetch(`/student/${userId}`);
                if (res.ok) {
                    const data = await res.json();
                    const photo = document.getElementById("sidebarPhoto");
                    if (photo && data && data.name) {
                        photo.src = data.photo_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(data.name)}&background=random&rounded=true&bold=true&size=128`;
                        photo.style.display = "block";
                    }
                }
            } catch (err) {
                console.warn("⚠️ Failed to load photo:", err.message);
            }

            // Handle form submission
            document.getElementById("feedbackForm").addEventListener("submit", async (e) => {
                e.preventDefault();

                const name = document.getElementById("name").value.trim();
                const email = document.getElementById("email").value.trim();
                const message = document.getElementById("message").value.trim();
                const submitBtn = document.querySelector('.submit-button');

                // Validation
                if (message.split(" ").filter(word => word.length > 0).length < 3) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Message Too Short',
                        text: 'Please enter at least 3 words in your message.',
                        confirmButtonColor: '#f7a048'
                    });
                    return;
                }

                // Disable button and show loading state
                submitBtn.disabled = true;
                const originalContent = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';

                try {
                    const res = await fetch("/api/submit-feedback", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ 
                            name, 
                            email, 
                            message,
                            userId: userId
                        }),
                    });

                    const data = await res.json();

                    if (res.ok && data.success) {
                        await Swal.fire({
                            icon: 'success',
                            title: 'Feedback Sent Successfully!',
                            text: 'Thank you for your feedback. We have received your message and will get back to you soon.',
                            confirmButtonColor: '#0b2e59',
                            timer: 3000,
                            showConfirmButton: true
                        });
                        document.getElementById("feedbackForm").reset();
                    } else {
                        throw new Error(data.message || 'Failed to send feedback');
                    }
                } catch (err) {
                    console.error('Feedback submission error:', err);
                    Swal.fire({
                        icon: 'error',
                        title: 'Failed to Send Feedback',
                        text: err.message || 'Something went wrong. Please try again or contact support directly.',
                        footer: '<p>If the problem persists, please contact the administrator.</p>',
                        confirmButtonColor: '#0b2e59'
                    });
                } finally {
                    // Re-enable button
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalContent;
                }
            });
        });
    </script>
    <script src="session.js"></script>
</body>
</html>
